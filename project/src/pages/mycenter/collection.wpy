<style lang="less">

</style>

<template>
  <view class="container">
    <repeat for="{{favlist.list}}" index="index" item="item" key="key">
      <collectionitem :goodsitem.sync="item"></collectionitem>
    </repeat>
    <listfooter :loading.sync="loading" :item.sync="favlist" :pagesize="page_size"></listfooter>
  </view>
</template>

<script>
import wepy from 'wepy'
import Mixin from '@/mixins/global'
import collectionitem from '@/components/collectionItem'
import listfooter from '@/components/listFooter'
export default class collection extends wepy.page {
  config = {
      navigationBarTitleText: '我的收藏',
  }
  components = {
      collectionitem,
      listfooter
  }
  mixins = [Mixin]
  data = {
    currentpage:1,
    favlist:{
      list:[],
      total_count:0,
      total_page:0,
    },
    loading:true
  }
  methods = {}
  getlist(){
    wepy.request({
        url: 'api/user_favorites/lists',
        method: 'POST',
        data: {
          per_page: 10,
          page: this.currentpage
        }
      }).then(res => {
        this.loading = false
        if(res.code == 1){
          // this.favlist.list = res.data.list.data
          if(!res.data.list){
            return;
          }
          if(this.currentpage == 1){
            this.favlist.list = res.data.list.data
          }else{
            this.favlist.list = this.favlist.list.concat(res.data.list.data)
          }

          this.favlist.total_count = res.data.list.total
          this.favlist.total_page = res.data.list.last_page
        }
        this.$apply()
      })
  }
  onLoad() {
    this.getlist()
  }
  onReachBottom(){
    console.log('bottom')
    this.currentpage+=1
    if(this.currentpage>this.favlist.total_page){
      return
    }
    this.getlist()
  }
}
</script>
